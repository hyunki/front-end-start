var Todo={$wrap:$(document.body),storageKey:"todos"};!function(o){o.util={uniqId:function(){return(new Date).getTime()},storage:{load:function(){return console.log("storage.load()"),JSON.parse(localStorage.getItem(o.storageKey)||"[]")},save:function(e,t){console.log("storage.save()"),localStorage.setItem(o.storageKey,JSON.stringify(t))}}},o.$wrap.on("addCollection",o.util.storage.save),o.$wrap.on("removeCollection",o.util.storage.save)}(Todo),function(o){o.model={id:"",title:"",check:!1}}(Todo),function(o,e){var t=[];o.collection={set:function(e){t=e;for(var n=0;n<t.length;n++)t[n].check===!0&&(console.log(t[n]),t.splice(n--,1));console.log(t),o.$wrap.trigger("addCollection",[t])},toJSON:function(){return t},add:function(e){t.push(e),o.$wrap.trigger("addCollection",[t])},remove:function(e){for(var n=0;n<t.length;n++)if(t[n].id===e){console.log("find",n),t.splice(n,1);break}o.$wrap.trigger("removeCollection",[t])},check:function(e){for(var n=0;n<t.length;n++)t[n].id===e&&(console.log("find",n),t[n].check=!t[n].check);console.log(t),o.$wrap.trigger("addCollection",[t])}}}(Todo,jQuery),function(o,e){var t=o("#todoList"),n=o("#todoTemplate").html();e.view={addTodo:function(t){var n=o(t.currentTarget),r=n.val();if(13!==t.keyCode||""===r)return console.log("event stop"),!1;n.val("");var l=o.extend({},e.model,{id:e.util.uniqId(),title:r,check:!1});e.collection.add(l)},render:function(){t.html(tmpl(n,{todos:e.collection.toJSON()}))}},e.$wrap.on("addCollection",e.view.render),e.$wrap.on("removeCollection",e.view.render)}(jQuery,Todo),function(){var o={};this.tmpl=function e(t,n){var r=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):o[t]=o[t]||e(document.getElementById(t).innerHTML);return n?r(n):r}}(),function(o,e,t){var n=o("#todoString"),r=o("#todoList");n.on("keyup",t.view.addTodo),r.on("click",".delete",function(e){var n=o(e.target),r=n.parent().data("id");t.collection.remove(r)}),r.on("click",".toggle-checked",function(e){console.log("toggle-checked");var n=o(e.target),r=n.parent().data("id");t.collection.check(r)});var l=t.util.storage.load();l&&(console.log(l),t.collection.set(l))}(jQuery,window,Todo);